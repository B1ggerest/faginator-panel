<!DOCTYPE html>
<html>
<head>
  <title>XOR Key Manager</title>
  <style>
    body { font-family: sans-serif; padding: 40px; text-align: center; background: #f2f2f2 }
    input, button { font-size: 16px; padding: 8px; margin: 5px }
    #panel { display: none; margin-top: 20px }
    ul { list-style: none; padding: 0; margin: 20px auto; max-width: 400px }
    li { background: white; padding: 10px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 5px; display: flex; justify-content: space-between; }
    .key { font-family: monospace; word-break: break-word; text-align: left; flex-grow: 1 }
  </style>
</head>
<body>
  <h2>Login</h2>
  <input id="pass" type="password" placeholder="Master Password" />
  <button onclick="login()">Login</button>

  <div id="panel">
    <h3>Key Panel</h3>
    <input id="key" placeholder="New key" />
    <button onclick="addKey()">Add</button>
    <ul id="list"></ul>
  </div>

<script>
const endpoint = "https://lively-frog-51c2.lolbiggerestlol.workers.dev";
let keys = [];
let password = "";

function xor(data, key) {
  return Array.from(data).map((char, i) =>
    String.fromCharCode(char.charCodeAt(0) ^ key.charCodeAt(i % key.length))
  ).join("");
}

async function login() {
  password = document.getElementById("pass").value;
  const res = await fetch(endpoint, {
    headers: { Authorization: password }
  });

  if (!res.ok) return alert("Login failed");

  const text = await res.text();
  const decoded = atob(text || "");
  const decrypted = xor(decoded, password);

  try {
    keys = JSON.parse(decrypted || "[]");
  } catch {
    keys = [];
  }

  document.getElementById("panel").style.display = "block";
  document.getElementById("pass").style.display = "none";
  document.querySelector("button").style.display = "none";
  render();
}

function render() {
  const ul = document.getElementById("list");
  ul.innerHTML = "";
  keys.forEach(k => {
    const li = document.createElement("li");
    li.innerHTML = `<span class="key">${k}</span><button onclick="removeKey('${k}')">‚ùå</button>`;
    ul.appendChild(li);
  });
}

async function addKey() {
  const val = document.getElementById("key").value.trim();
  if (!val || keys.includes(val)) return;
  keys.push(val);
  document.getElementById("key").value = "";
  await sync(); render();
}

async function removeKey(k) {
  keys = keys.filter(x => x !== k);
  await sync(); render();
}

async function sync() {
  const encoded = JSON.stringify(keys);
  const encrypted = xor(encoded, password);
  const payload = btoa(encrypted);

  await fetch(endpoint, {
    method: "PUT",
    headers: {
      Authorization: password,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ content: payload })
  });
}
</script>
</body>
</html>
