<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tool License Admin</title>
  <style>
    body { background: #0a0a0a; color: #fff; font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    input, button { padding: 0.75rem; margin: 0.5rem 0; width: 100%; border-radius: 4px; border: none; font-size: 1rem; }
    .card { background: #1a1a1a; padding: 2rem; border-radius: 10px; margin-top: 2rem; }
    .hidden { display: none; }
    .success { color: #00ff88; }
    .error { color: #ff4444; }
    .label { margin-top: 1rem; display: block; }
  </style>
</head>
<body>

  <h1>License Key Admin Panel</h1>

  <div class="card" id="loginCard">
    <h2>Login</h2>
    <input type="password" id="passwordInput" placeholder="Master password" />
    <button onclick="login()">Login</button>
    <div id="loginStatus"></div>
  </div>

  <div class="card hidden" id="dashboardCard">
    <h2>Manage Keys</h2>

    <h3>Create New Key</h3>
    <input type="text" id="usernameInput" placeholder="Username (optional)" />
    <button onclick="createKey()">Generate Key</button>
    <div id="createStatus"></div>
    <pre id="createdKey" style="margin-top:1rem;"></pre>

    <h3 style="margin-top: 2rem;">Delete Key</h3>
    <input type="text" id="deleteInput" placeholder="Enter key to delete" />
    <button onclick="deleteKey()">Delete Key</button>
    <div id="deleteStatus"></div>
  </div>

  <script>
    const API = "https://lively-frog-51c2.lolbiggerestlol.workers.dev";
    let token = null;

    async function login() {
      const password = document.getElementById("passwordInput").value;
      const res = await fetch(`${API}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password })
      });

      const out = await res.json();
      const status = document.getElementById("loginStatus");
      if (res.ok) {
        token = out.token;
        status.className = "success";
        status.textContent = "✅ Login successful!";
        document.getElementById("loginCard").classList.add("hidden");
        document.getElementById("dashboardCard").classList.remove("hidden");
      } else {
        status.className = "error";
        status.textContent = "❌ " + (out.error || "Login failed");
      }
    }

    async function createKey() {
      const username = document.getElementById("usernameInput").value;
      const res = await fetch(`${API}/create`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({ username })
      });

      const out = await res.json();
      const status = document.getElementById("createStatus");
      const keyBox = document.getElementById("createdKey");
      if (res.ok) {
        status.className = "success";
        status.textContent = "✅ Key created!";
        keyBox.textContent = out.apiKey;
      } else {
        status.className = "error";
        status.textContent = "❌ " + (out.error || "Failed to create key");
        keyBox.textContent = "";
      }
    }

    async function deleteKey() {
      const apiKey = document.getElementById("deleteInput").value;
      const res = await fetch(`${API}/delete`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({ apiKey })
      });

      const out = await res.json();
      const status = document.getElementById("deleteStatus");
      if (res.ok) {
        status.className = "success";
        status.textContent = "✅ Key deleted.";
      } else {
        status.className = "error";
        status.textContent = "❌ " + (out.error || "Delete failed");
      }
    }
  </script>
</body>
</html>
